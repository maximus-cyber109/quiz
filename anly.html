<!DOCTYPE html>
<html lang="en">
<head>
    <!-- â”€â”€â”€â”€â”€â”€â”€â”€  GA4 tracking  â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BF9BJ3YW4Z"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-BF9BJ3YW4Z');          // default page-view
    </script>
    <!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->

    <meta charset="UTF-8">
    <title>ðŸ¦· PB Quiz Analytics Dashboard</title>
    <style>
        body{font-family:Arial,sans-serif;padding:20px;background:#f5f5f5}
        .dashboard{max-width:800px;margin:0 auto}
        .stat-card{background:#fff;padding:20px;margin:15px 0;border-radius:10px;
                   box-shadow:0 2px 5px rgba(0,0,0,.1)}
        .stat-number{font-size:2em;color:#4285f4;font-weight:bold}
        .stat-label{color:#666;margin-top:5px}
        .refresh-btn{background:#4285f4;color:#fff;padding:10px 20px;border:none;
                     border-radius:5px;cursor:pointer}
    </style>
</head>
<body>
<div class="dashboard">
    <h1>ðŸ¦· PB Quiz Analytics Dashboard</h1>

    <div class="stat-card">
        <div class="stat-number" id="totalPlays">Loadingâ€¦</div>
        <div class="stat-label">Total Quiz Plays</div>
    </div>

    <div class="stat-card">
        <div class="stat-number" id="completions">Loadingâ€¦</div>
        <div class="stat-label">Quiz Completions</div>
    </div>

    <div class="stat-card">
        <div class="stat-number" id="excellentScores">Loadingâ€¦</div>
        <div class="stat-label">Excellent Scores (9-10)</div>
    </div>

    <button class="refresh-btn" onclick="manualRefresh()">Refresh Stats</button>
</div>

<script>
  const API_KEY = 'pbquiz-analytics-2025';

  async function loadStats(){
    try{
      const [plays, comps, excellent] = await Promise.all([
        fetch(`https://api.countapi.xyz/get/${API_KEY}/quiz-starts`).then(r=>r.json()),
        fetch(`https://api.countapi.xyz/get/${API_KEY}/quiz-completions`).then(r=>r.json()),
        fetch(`https://api.countapi.xyz/get/${API_KEY}/excellent-scores`).then(r=>r.json())
      ]);
      document.getElementById('totalPlays').textContent =
          (plays.value||0).toLocaleString();
      document.getElementById('completions').textContent =
          (comps.value||0).toLocaleString();
      document.getElementById('excellentScores').textContent =
          (excellent.value||0).toLocaleString();
    }catch(err){
      console.error('Stats load error:',err);
    }
  }

  function manualRefresh(){
    gtag('event','refresh_stats_click',{event_category:'dashboard'});
    loadStats();
  }

  // initial load + 30-s auto-refresh
  loadStats();
  setInterval(loadStats,30_000);
</script>
</body>
</html>
